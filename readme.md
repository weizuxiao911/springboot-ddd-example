
### 应用架构设计

项目工程秉承 DDD（领域驱动设计）思想，使用 Maven Modules 方式构建，采用分层架构设计，将项目工程内部拆分成 4 层结构。


#### 一、parent 说明

虽然项目工程使用 Maven Modules 方式构建，但最外层的 pom.xml 仅作为管理 modules 实现模块聚合，内部各层仍采用统一封装的 parent 依赖包。如此设计的主要思考如下：

1. 为确保项目工程依赖包版本的统一性，需引入统一的 parent 包进行依赖管理。
2. 项目工程最外层的 pom.xml 仅承担 modules 的聚合管理，不依赖 parent，内部模块自行依赖 parent，这样可减少包依赖层级的复杂度。


#### 二、DDD 四层结构

##### 1. 领域层（domain）

- 核心职责：根据业务抽象出领域模型（充血模型）、领域服务、领域事件、值对象等，对业务进行具象化（封装业务规则和核心逻辑）。
- 技术实现：纯 Java 实现，不依赖任何 Spring 组件或技术框架。
- 核心内容
  - 充血模型的领域对象（实体、聚合根，包含业务行为和规则）
  - 领域服务（领域内跨实体的业务逻辑，需多个实体协作完成的操作）
  - 仓储接口（Repository 接口，定义领域对象的持久化契约，不包含实现）
  - 值对象、枚举、领域事件（封装无唯一标识的属性或事件通知逻辑）


##### 2. 应用层（application）

- 核心职责：通过应用服务实现业务流程编排，协调领域层完成用例，对外提供业务能力接口。
- 技术实现：纯 Java 实现（包含接口和核心逻辑），不依赖 Spring 组件，可独立运行和测试。
- 核心内容：
  - 应用服务（接口+实现）：编排领域服务和领域对象，实现完整业务流程（如“用户注册→创建账号→发送通知”）
  - 命令/查询对象（Command/Query）：封装应用服务的输入参数，明确操作意图（避免方法参数过多）
  - DTO（数据传输对象）：定义应用层与接口层之间的数据交互格式，屏蔽领域对象细节


##### 3. 接口层（interfaces）

- 核心职责：定义对外暴露的访问接口契约，实现外部请求与应用层的适配。
- 技术实现：仅定义接口和转换规则，依赖 Spring 注解（如`@GetMapping`、`@FeignClient`），不包含业务逻辑。
- 核心内容
  - Controller 接口：定义 HTTP 接口契约（路径、参数、响应格式）
  - Feign 客户端接口：定义服务间远程调用契约
  - DTO 转换器接口：声明领域对象与 DTO 的转换规则（如`User → UserDTO`）


##### 4. 基础设施层（infrastructure）

- 核心职责：提供技术实现支持，落地上层定义的接口，处理与外部资源的交互。
- 技术实现：依赖 Spring Boot 及其他框架（如 MyBatis、Redis），实现所有技术细节。
- 核心内容：
  - Controller 实现：实现接口层的 Controller 接口，处理 HTTP 请求（参数解析、调用应用服务、返回响应）
  - 仓储实现：实现领域层的 Repository 接口（如用 MyBatis/JPA 操作数据库）
  - 应用服务适配器：对应用层的应用服务进行技术增强（如添加`@Transactional`、`@Service`注解，注册为 Spring Bean）
  - DTO 转换器实现：实现接口层的转换规则（如用 MapStruct 完成对象映射）
  - Spring 配置：Bean 注册、事务管理、缓存配置等技术组件


#### 三、模块依赖关系

1. 严格遵循**单向依赖**原则，避免循环依赖。

```plaintext
infrastructure → application → domain
       ↑                ↑
       └── interfaces ──┘

# 基础设施层依赖接口层和应用层
# 接口层依赖应用层
# 应用层依赖领域层
# 领域层不依赖任何层
```

2. 父模块 pom.xml 中定义构建顺序（按依赖层级排序）

```xml
<modules>
    <module>domain</module>
    <module>application</module>
    <module>interfaces</module>
    <module>infrastructure</module>
</modules>
```


#### 四、核心优势

1. 业务与技术解耦：领域层和应用层纯 Java 实现，核心业务逻辑不依赖框架，可独立测试和迁移。
2. 可替换性：基础设施层的技术实现（如从 JPA 换为 MyBatis）不影响上层业务逻辑。
3. 团队协作：领域专家可专注于 domain 模块设计业务规则，开发人员专注于 infrastructure 模块实现技术细节。
4. 可测试性：领域层和应用层可通过单元测试验证业务逻辑，无需启动 Spring 容器或依赖外部资源。


#### 五、注意事项

1. 接口层的 FeignClient 接口需在基础设施层通过`@EnableFeignClients`扫描注册。
2. 仓储接口的实现类需用`@Repository`注解，确保被 Spring 容器扫描管理。
3. 事务注解`@Transactional`仅在基础设施层的“应用服务适配器”上使用，控制业务流程的事务边界。
4. 领域层禁止引入任何框架注解（如 JPA 的`@Entity`应放在基础设施层的数据库实体类上）。
5. 应用层的核心逻辑需独立于 Spring 实现，基础设施层仅通过“适配器”模式添加技术注解（如`@Service`）。
